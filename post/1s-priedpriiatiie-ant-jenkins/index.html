<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.101.0" />

  <title>1С:Предприятие &#43; Ant &#43; jenkins &middot; Andrey Popov</title>

  <meta name="description" content="1С:Предприятие 8 - continius integration (Jenkins &#43; Ant)" />

  

<meta itemprop="name" content="1С:Предприятие &#43; Ant &#43; jenkins">
<meta itemprop="description" content="1С:Предприятие 8 - continius integration (Jenkins &#43; Ant)"><meta itemprop="datePublished" content="2013-03-16T00:00:00+00:00" />
<meta itemprop="dateModified" content="2013-03-16T00:00:00+00:00" />
<meta itemprop="wordCount" content="613">
<meta itemprop="keywords" content="1С:Предприятие 8,ant,jenkins,ci/cd," />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="1С:Предприятие &#43; Ant &#43; jenkins"/>
<meta name="twitter:description" content="1С:Предприятие 8 - continius integration (Jenkins &#43; Ant)"/>


<meta property="og:title" content="1С:Предприятие &#43; Ant &#43; jenkins" />
<meta property="og:description" content="1С:Предприятие 8 - continius integration (Jenkins &#43; Ant)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://popov1024.github.io/post/1s-priedpriiatiie-ant-jenkins/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2013-03-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2013-03-16T00:00:00+00:00" />




  <link type="text/css"
        rel="stylesheet"
        href="/css/print.css"
        media="print">

  <link type="text/css"
        rel="stylesheet"
        href="/css/poole.css">

  <link type="text/css"
        rel="stylesheet"
        href="/css/hyde.css">

  


  

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
        crossorigin="anonymous" />

  <link rel="apple-touch-icon-precomposed"
        sizes="144x144"
        href="/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/favicon.png">

  
  </head>
<body>
  <aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <img src="/images/profile.png" class="img-circle img-headshot center" alt="Profile Picture">
        </div>
        
      

      <h1>Andrey Popov</h1>

      
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li>
          <a href="https://popov1024.github.io/">Home</a>
        </li>
        <li>
          <a href="/posts/">Posts</a>
        </li><li>
          <a href="/tags/">Tags</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
      <a href="https://github.com/popov1024" rel="me" title="Github" target="_blank">
        <i class="fab fa-github" aria-hidden="true"></i>
      </a>
      
      <a href="https://twitter.com/andrey_popov" rel="me" title="Twitter" target="_blank">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      
    </section>
  </div>
</aside>


  <main class="content container">
  <div class="post">
  <h1>1С:Предприятие &#43; Ant &#43; jenkins</h1>

  <div class="post-date">
    <time datetime="2013-03-16T00:00:00Z">Mar 16, 2013</time> &middot; 3 min read
  </div>

  <p>1С:Предприятие обладает очень скудными средствами разработки и интеграции. Однако выжать максимум автоматизации сборки и публикации можно.
Мои проекты имеют следующий жизненный цикл:</p>
<ol>
<li>Внесение изменений в код согласно <code>Jira</code></li>
<li>Выпуск тестовой сборки</li>
<li>Исправление ошибок по необходимости</li>
<li>Выпуск релиза (проверка конфигурации, формирование <code>cf</code> + <code>cfu</code>, формирование отчета по измененным объектам хранилища конфигурации)</li>
<li>Изменение версии в хранилище конфигурации</li>
</ol>
<p>Для выпуска релиза мной разработан <code>build.xml</code> для <code>Apache Ant</code></p>
<pre><code class="language-xml">&lt;project name=&quot;kisnpo&quot; default=&quot;build&quot;&gt;
    &lt;description&gt;kisnpo build&lt;/description&gt;
    &lt;property environment=&quot;env&quot;/&gt;
    &lt;property name=&quot;rep&quot; value=&quot;tcp://share\myproject\&quot;/&gt;
    &lt;property name=&quot;replogin&quot; value=&quot;login&quot;/&gt;
    &lt;property name=&quot;reppassword&quot; value=&quot;password&quot;/&gt;
    &lt;property name=&quot;ibname&quot; value=&quot;c:\ib\myproject&quot;/&gt;
    &lt;property name=&quot;ib&quot; value=&quot;/F${ibname}&quot;/&gt;
    &lt;property name=&quot;iblogin&quot; value=&quot;login&quot;/&gt;
    &lt;property name=&quot;ibpassword&quot; value=&quot;password&quot;/&gt;
    &lt;property name=&quot;connectionstring&quot; value=&quot;Usr=&quot;${iblogin}&quot;;Pwd=&quot;${ibpassword}&quot;;File=&quot;${ibname}&quot;;&quot;/&gt;
    &lt;property name=&quot;1cbin&quot; location=&quot;C:\Program Files (x86)\1cv81\bin\1cv8.exe&quot;/&gt;
    &lt;property name=&quot;1cbincom&quot; value=&quot;V81.COMConnector&quot;/&gt;
    &lt;property name=&quot;builds&quot; location=&quot;${env.WORKSPACE}&quot;/&gt;
    &lt;property name=&quot;publishdebug&quot; location=&quot;\\ftp\project-test&quot;/&gt;
    &lt;property name=&quot;publish&quot; location=&quot;\\ftp\project&quot;/&gt;
    &lt;property name=&quot;NBegin&quot; value=&quot;1&quot;/&gt;
    &lt;property name=&quot;NEnd&quot; value=&quot;1&quot;/&gt;
    &lt;target name=&quot;init&quot; depends=&quot;build-version&quot;&gt;
        &lt;fail if=&quot;version_present&quot; message=&quot;Version ${version} is builed&quot;/&gt;
        &lt;echo message=&quot;ok&quot;/&gt;
    &lt;/target&gt;
    &lt;target name=&quot;build-version&quot; unless=&quot;version&quot;&gt;
        &lt;exec executable=&quot;powershell.exe&quot; output=&quot;.version&quot; failonerror=&quot;true&quot;&gt;
            &lt;arg value=&quot;$c=new-object -comobject \&quot;${1cbincom}\&quot;;&quot;/&gt;
            &lt;arg value=&quot;$b=$c.Connect(\&quot;${connectionstring}\&quot;);&quot;/&gt;
            &lt;arg value=&quot;$medata=[System.__ComObject].invokemember(\&quot;Metadata\&quot;,[System.Reflection.BindingFlags]::GetProperty,$null,$b,$null);&quot;/&gt;
            &lt;arg value=&quot;[String]$buildversion = [System.__ComObject].invokemember(\&quot;Version\&quot;,[System.Reflection.BindingFlags]::GetProperty,$null,$medata ,$null);&quot;/&gt;
            &lt;arg value=&quot;echo $buildversion;&quot;/&gt;
            &lt;arg value=&quot;$rb=[System.Runtime.Interopservices.Marshal]::ReleaseComObject($b);&quot;/&gt;
            &lt;arg value=&quot;$rc=[System.Runtime.Interopservices.Marshal]::ReleaseComObject($c)&quot;/&gt;
        &lt;/exec&gt;
        &lt;loadfile property=&quot;version&quot; srcFile=&quot;.version&quot;&gt;
            &lt;filterchain&gt;
                &lt;striplinebreaks/&gt;
            &lt;/filterchain&gt;
        &lt;/loadfile&gt;
        &lt;available filepath=&quot;${builds}&quot; file=&quot;${version}&quot; type=&quot;dir&quot; property=&quot;version_present&quot;/&gt;
        &lt;echo message=&quot;ok&quot;/&gt;
    &lt;/target&gt;
    &lt;target name=&quot;clean&quot;&gt;
        &lt;delete file=&quot;.version&quot;/&gt;
        &lt;delete file=&quot;.checkerror&quot;/&gt;
        &lt;delete file=&quot;.updatescf&quot;/&gt;
        &lt;delete file=&quot;.resultcheck&quot;/&gt;
        &lt;delete file=&quot;.report&quot;/&gt;
        &lt;echo message=&quot;ok&quot;/&gt;
    &lt;/target&gt;
    &lt;target name=&quot;update&quot;&gt;
        &lt;exec executable=&quot;${1cbin}&quot; failonerror=&quot;true&quot;&gt;
            &lt;arg value=&quot;CONFIG&quot;/&gt;
            &lt;arg value=&quot;${ib}&quot;/&gt;
            &lt;arg value=&quot;/N${iblogin}&quot;/&gt;
            &lt;arg value=&quot;/P${ibpassword}&quot;/&gt;
            &lt;arg value=&quot;/ConfigurationRepositoryF${rep}&quot;/&gt;
            &lt;arg value=&quot;/ConfigurationRepositoryN${replogin}&quot;/&gt;
            &lt;arg value=&quot;/ConfigurationRepositoryP${reppassword}&quot;/&gt;
            &lt;arg value=&quot;/ConfigurationRepositoryUpdateCfg&quot;/&gt;
            &lt;arg value=&quot;-force /UpdateDBCfg&quot;/&gt;
        &lt;/exec&gt;
        &lt;echo message=&quot;ok&quot;/&gt;
    &lt;/target&gt;
	&lt;target name=&quot;check&quot; depends=&quot;update&quot;&gt;
		&lt;exec executable=&quot;${1cbin}&quot; output=&quot;.resultcheck&quot; failonerror=&quot;true&quot;&gt;
			&lt;arg value=&quot;CONFIG&quot;/&gt;
			&lt;arg value=&quot;${ib}&quot;/&gt;
			&lt;arg value=&quot;/N${iblogin}&quot;/&gt;
			&lt;arg value=&quot;/P${ibpassword}&quot;/&gt;
			&lt;arg value=&quot;/ConfigurationRepositoryF${rep}&quot;/&gt;
			&lt;arg value=&quot;/ConfigurationRepositoryN${replogin}&quot;/&gt;
			&lt;arg value=&quot;/ConfigurationRepositoryP${reppassword}&quot;/&gt;
			&lt;arg value=&quot;/CheckConfig&quot;/&gt;
			&lt;arg value=&quot;-IncorrectReferences&quot;/&gt;
			&lt;arg value=&quot;-Client&quot;/&gt;
			&lt;arg value=&quot;-ClientServer&quot;/&gt;
			&lt;arg value=&quot;-ExternalConnectionServer&quot;/&gt;
			&lt;arg value=&quot;-ExternalConnection&quot;/&gt;
			&lt;arg value=&quot;-Server&quot;/&gt;
			&lt;arg value=&quot;-DistributiveModules&quot;/&gt;
			&lt;arg value=&quot;-ConfigLogicalIntegrity&quot;/&gt;
			&lt;arg value=&quot;/DumpResult .checkerror&quot;/&gt;
		&lt;/exec&gt;
		&lt;loadfile property=&quot;checkerror&quot; srcFile=&quot;.checkerror&quot; encoding=&quot;utf-8&quot;&gt;
			&lt;filterchain&gt;
				&lt;tokenfilter&gt;
					&lt;containsregex pattern=&quot;^[^0-9\-]+(0)$&quot;/&gt;
				&lt;/tokenfilter&gt;
			&lt;/filterchain&gt;
		&lt;/loadfile&gt;
		&lt;fail unless=&quot;checkerror&quot;/&gt;
		&lt;echo message=&quot;ok&quot;/&gt;
	&lt;/target&gt;
	&lt;target name=&quot;build&quot; depends=&quot;check,init&quot; unless=&quot;version_present&quot;&gt;
		&lt;exec executable=&quot;cmd.exe&quot;&gt;
			&lt;arg value=&quot;/c&quot;/&gt;
			&lt;arg value=&quot;rd&quot;/&gt;
			&lt;arg value=&quot;.last&quot;/&gt;
		&lt;/exec&gt;
		&lt;echo message=&quot;Build version is ${version}&quot;/&gt;
		&lt;exec executable=&quot;powershell.exe&quot; output=&quot;.updatescf&quot; failonerror=&quot;true&quot;&gt;
			&lt;arg value=&quot;[String]$p=\&quot;\&quot;;&quot;/&gt;
			&lt;arg value=&quot;ls ${builds}\* -Include 1cv8.cf -Recurse | split-path -parent | split-path -leaf | foreach {$p = $p + \&quot; -f $_\1cv8.cf -v $_ \&quot;};&quot;/&gt;
			&lt;arg value=&quot;echo $p&quot;/&gt;
		&lt;/exec&gt;
		&lt;loadfile property=&quot;updatescf&quot; srcFile=&quot;.updatescf&quot;&gt;
			&lt;filterchain&gt;
				&lt;striplinebreaks/&gt;
			&lt;/filterchain&gt;
		&lt;/loadfile&gt;
		&lt;exec executable=&quot;${1cbin}&quot; output=&quot;.resultcheck&quot; failonerror=&quot;true&quot;&gt;
			&lt;arg value=&quot;CONFIG&quot;/&gt;
			&lt;arg value=&quot;${ib}&quot;/&gt;
			&lt;arg value=&quot;/N${iblogin}&quot;/&gt;
			&lt;arg value=&quot;/P${ibpassword}&quot;/&gt;
			&lt;arg value=&quot;/ConfigurationRepositoryF${rep}&quot;/&gt;
			&lt;arg value=&quot;/ConfigurationRepositoryN${replogin}&quot;/&gt;
			&lt;arg value=&quot;/ConfigurationRepositoryP${reppassword}&quot;/&gt;
			&lt;arg value=&quot;/CreateDistributionFiles -cffile ${version}\1cv8.cf -cfufile ${version}\1cv8.cfu&quot;/&gt;
			&lt;arg value=&quot;${updatessubcf}&quot;/&gt;
			&lt;arg value=&quot;${updatescf}&quot;/&gt;
		&lt;/exec&gt;
		&lt;sleep seconds=&quot;30&quot;/&gt;
		&lt;exec executable=&quot;cmd.exe&quot;&gt;
			&lt;arg value=&quot;/c&quot;/&gt;
			&lt;arg value=&quot;mklink&quot;/&gt;
			&lt;arg value=&quot;/J&quot;/&gt;
			&lt;arg value=&quot;.last&quot;/&gt;
			&lt;arg value=&quot;${version}&quot;/&gt;
		&lt;/exec&gt;
		&lt;echo message=&quot;ok&quot;/&gt;
	&lt;/target&gt;
	&lt;target name=&quot;publishdebug&quot; depends=&quot;build-version&quot; if=&quot;${publishdebugenable}&quot;&gt;
		&lt;copy todir=&quot;${publishdebug}/${version}&quot;&gt;
			&lt;fileset dir=&quot;${builds}/${version}&quot;/&gt;
		&lt;/copy&gt;
		&lt;echo message=&quot;ok&quot;/&gt;
	&lt;/target&gt;
	&lt;target name=&quot;publish&quot; depends=&quot;build-version&quot; if=&quot;${publishenable}&quot;&gt;
		&lt;copy todir=&quot;${publish}/${version}&quot;&gt;
			&lt;fileset dir=&quot;${builds}/${version}&quot;/&gt;
		&lt;/copy&gt;
		&lt;echo message=&quot;ok&quot;/&gt;
	&lt;/target&gt;
	&lt;target name=&quot;report&quot;&gt;
		&lt;exec executable=&quot;${1cbin}&quot;&gt;
			&lt;arg value=&quot;CONFIG&quot;/&gt;
			&lt;arg value=&quot;${ib}&quot;/&gt;
			&lt;arg value=&quot;/N${iblogin}&quot;/&gt;
			&lt;arg value=&quot;/P${ibpassword}&quot;/&gt;
			&lt;arg value=&quot;/ConfigurationRepositoryF${rep}&quot;/&gt;
			&lt;arg value=&quot;/ConfigurationRepositoryN${replogin}&quot;/&gt;
			&lt;arg value=&quot;/ConfigurationRepositoryP${reppassword}&quot;/&gt;
			&lt;arg value=&quot;/ConfigurationRepositoryReport ${version}/.report -NBegin ${NBegin} -NEnd ${NEnd} -GroupByObject -GroupByComment&quot;/&gt;
		&lt;/exec&gt;
		&lt;sleep seconds=&quot;30&quot;/&gt;
	&lt;/target&gt;
&lt;/project&gt;
</code></pre>
<p>Данный build.xml подразумевает следующую структуру каталогов:</p>
<pre><code class="language-none">&lt;Builds&gt;
    [Project name]
        [.last]      - ссылка на последнюю мажорную версию
        [Version 1]
        [Version 2]
        ...
        [Version n]
            [.last]  - ссылка на последнюю минорную версию
            [Buld 1]
            [Buld 2]
            ...
            [Buld m]
</code></pre>
<p>Например:</p>
<pre><code class="language-none">MyProject
    [.last]
    [1.0.1]
        [.last]
        [1.0.1.1]
        [1.0.1.2]
        [1.0.1.3]
        [1.0.1.4]
    [1.0.2]
        [.last]
        [1.0.1.4] - ссылка на предыдущую последнюю (релизную) мажорную сборку
        [1.0.2.1]
        [1.0.2.2]
</code></pre>
<p>Для каждой мажорной версии в <code>jenkins</code> создается своя задача. <code>CI</code>-системы Bamboo или <code>Team City</code> позволяют добиться более удобного представления проектов, но пока мне хватает простоты и бесплатности <code>Jenkins</code>.</p>
<p>Переключение версии никакими стандартными средствами <code>1С</code> не предусмотрено, так же никак нельзя автоматизированно узнать номера изменений хранилища конфигурации для построения отчета по измененным объектам.</p>
<p>В чем плюсы такой связки? Во-первых, это упрощает и автоматизирует типовые этапы жизненного цикла проектов. Да - можно было написать все просто скриптами (как и было до этого), но в конечном счете этот путь приведет к написанию чего-нибудь наподобие <code>Apache Ant</code>, когда нужно на этапе выполнения определить зависимость целей и все необходимые параметры. Во-вторых, используя <code>Apache Ant</code> мы обеспечиваем возможность работы с различными современными <code>CI</code>.</p>

</div>


  </main>

  <footer>
  <div>
    &copy; Andrey Popov 2022

    

    
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
          integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
          crossorigin="anonymous"></script>

  

  
</body>
</html>
